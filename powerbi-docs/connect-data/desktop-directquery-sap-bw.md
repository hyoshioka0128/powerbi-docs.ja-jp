---
title: Power BI での DirectQuery と SAP Business Warehouse (BW)
description: SAP Business Warehouse (BW) で DirectQuery を使用する場合の考慮事項
author: davidiseminger
ms.reviewer: ''
ms.service: powerbi
ms.subservice: powerbi-desktop
ms.topic: conceptual
ms.date: 11/28/2018
ms.author: davidi
LocalizationGroup: Connect to data
ms.openlocfilehash: ceaa557be31625c9573a7285602a1a4ef8164fb7
ms.sourcegitcommit: 0e9e211082eca7fd939803e0cd9c6b114af2f90a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/13/2020
ms.locfileid: "83292664"
---
# <a name="connect-to-sap-business-warehouse-by-using-directquery-in-power-bi"></a>Power BI で DirectQuery を使用して SAP Business Warehouse に接続する
**SAP Business Warehouse (BW)** データ ソースへは、**DirectQuery** を使用して直接接続することが可能です。 SAP BW は OLAP/多次元的な性質があるため、SAP BW での DirectQuery と SQL Server などのリレーショナル ソース間では多数の重要な違いがあります。 これらの相違点は次のとおりです。

* リレーショナル ソースを使用する **DirectQuery** では、フィールド リストで使用できるデータを論理的に定義する ( **[データの取得]** または **[クエリ エディター]** ダイアログで定義される) 一連のクエリがあります。 これは、SAP BW などの OLAP ソースに接続するときには*該当しません*。 代わりに、 **[データの取得]** を使用して SAP サーバーに接続する場合、インフォキューブまたは BEx クエリのみが選択されます。 すると、選択されたインフォキューブ/BEx クエリのすべての主要な指標とディメンションがフィールド リストで使用できるようになります。   
* 同様に、SAP BW に接続する場合には、 **[クエリ エディター]** はありません。 (サーバー名などの) データ ソースの設定は、 **[クエリを編集]、[データ ソース設定]** を選択して変更できます。 任意のパラメーターの設定は、 **[クエリを編集]、[パラメーターの管理]** の順に選択して変更できます。
* OLAP ソースには、DirectQuery に対する通常の制限のみでなく、他にも、その固有の性質ゆえに (モデリングと視覚エフェクトの両方に) 制限が適用されます。 これらの制限については、この記事の後半で説明します。

また、Power BI ではサポートされない SAP BW の機能が多数あり、SAP BW へのパブリック インターフェイスの性質のため、Power BI で表示される結果が SAP ツールを使用した場合の結果と一致しない重要なケースがあることを理解しておくことが*非常に重要*です。 これらの制限については、この記事の後半で説明します。 これらの制限と動作の違いには慎重になり、SAP のパブリック インターフェイスによって返される Power BI に表示される結果が、正しく解釈されることを確認する必要があります。  

> [!NOTE]
> SAP BW で DirectQuery を使う機能は、Power BI Desktop の 2018 年 3 月の更新までプレビューでした。 プレビュー期間中のフィードバックや改善提案を基に、そのプレビュー バージョンを使って作成されるレポートに影響を与える変更が行われました。 SAP BW での DirectQuery が一般公開 (GA) されたことで、GA 前バージョンで作成された、SAP BW での DirectQuery を使う既存の (プレビュー ベースの) レポートをすべて破棄する "*必要があります*"。 SAP BW での DirectQuery の GA 前バージョンで作成されたレポートでは、更新を呼び出すと、基になっている SAP BW キューブに変更のあるメタデータを更新しようとするため、エラーが発生します。 このようなレポートは、SAP BW での DirectQuery の GA バージョンを使って、空のレポートから作り直してください。 

## <a name="additional-modeling-restrictions"></a>その他のモデリングの制限
Power BI で DirectQuery を使用して SAP BW に接続する場合のモデリング上のその他の主要な制限は次のとおりです。

* **計算列のサポートがない:** 計算列を作成する機能は無効です。 これは、計算列を作成するグループ化とクラスタリングも使用できないことを意味します。
* **メジャーのその他の制限:** メジャーで使用できる、SAP BW のサポート レベルを反映する DAX 式の制限がこの他にもあります。
* **リレーションシップの定義のサポートがない:** リレーションシップは外部 SAP ソースに内在しており、モデルではリレーションシップを追加定義できません。
* **データ ビューがない:** **[データ ビュー]** は、通常詳細レベル データをテーブルに表示します。 SAP BW などの OLAP のソースの性質から、このビューは SAP BW では使用できません。
* **列とメジャーの詳細は固定:** フィールド リストにある列とメジャーの一覧は、基になるソースによって固定されており、変更できません。 たとえば、列を削除したり、そのデータ型を変更したりすることはできません (ただし、名前変更は可能です)。
* **DAX のその他の制限:** メジャーの定義で使用できる DAX には、ソースの制限と一致する制限がこの他にもあります。 たとえば、テーブルに集計関数は使用できません。

## <a name="additional-visualization-restrictions"></a>視覚エフェクトのその他の制限
Power BI で DirectQuery を使用して SAP BW に接続する場合の視覚エフェクトのその他の主要な制限は次のとおりです。

* **列集計ができない:** ビジュアルでは列の集計の変更はできません。常に *[集計しない]* です。
* **メジャーのフィルターは無効:** SAP BW でのサポートと一致するようにメジャーのフィルターは無効になっています。
* **複数選択と含める/除外する:** ビジュアルでは、複数の列の値である場合、データ ポイントを複数選択する機能は無効です。 たとえば、凡例にカテゴリがある、国別の売上を示す棒グラフがある場合、(USA, Bikes) と (France, Clothes) のポイントを選択できません。 これと同様に、(USA, Bikes) のポイントを選択し、それをビジュアルから除外することはできません。 いずれも、SAP BW でのサポートと一致するよう制限されています。

## <a name="support-for-sap-bw-features"></a>SAP BW の機能のサポート
次の表では、完全にはサポートされていない、または Power BI を使用した場合に異なる動作をする SAP BW のすべての機能を示します。   

| 機能 | Description |
| --- | --- |
| ローカル計算 |BEx クエリで定義されているローカル計算は、BEx アナライザーなどのツールによって表示されるよう数値を変更します。 ただし、これはパブリックの MDX インターフェイスを介して返される、SAP から返される数値には反映されません。 <br/> <br/> **そのため、Power BI のビジュアルに表示される数値は、SAP ツールの対応するビジュアルのものとは必ずしも一致しません。**<br/> <br/>  たとえば、集計が累積される (集計の実行などの) クエリ キューブに BEx クエリから接続する場合、Power BI はこの設定を無視して底の数値を返します。  もちろんアナリストは Power BI でローカルで実行中の合計の計算を適用できますが、これが行われていない場合は、数値がどのように解釈されるか、注意する必要があります。 |
| 集計 |場合によっては (特に複数の通貨を扱う場合)、SAP パブリック インターフェイスによって返される集計数が SAP ツールで表示されるものと異なる場合があります。 <br/> <br/> **そのため、Power BI のビジュアルに表示される数値は、SAP ツールの対応するビジュアルのものとは必ずしも一致しません。** <br/> <br/> たとえば、BEx アナライザーではさまざまな通貨の合計は "*" と表示されますが、SAP パブリック インターフェイスでは、そのような集計数には意味がないという情報は表示しないまま、合計数が返されます。 つまり、($、EUR、および AUD などの集計) 数値が Power BI で表示されます。 |
| 通貨の書式設定 |Power BI では、通貨のいかなる書式設定 (たとえば、$2,300 または 4000 AUD) も反映されません。 |
| 測定単位 |Power BI では、測定単位 (たとえば、230 KG) は反映されません。 |
| キーとテキスト (短い、中間、長い) |CostCenter など SAP BW の指標には、フィールド リストで CostCenter という列が 1 つ表示されます。  その列を使用すると、既定のテキストが表示されます。  非表示のフィールドを表示すると、一意の名前列を確認することも可能になります (これでは、SAP BW によって割り当てられた、一意であることの基準である、固有の名前が返されます)。<br/> <br/>  キーとその他のテキスト フィールドは使用できません。 |
| 指標の複数の階層 |**SAP** では、指標には複数の階層を持たせることが可能です。 そのようにすると、BEx アナライザーなどのツールでは、指標がクエリに含まれると、ユーザーが使用する階層を選択できるようになります。 <br/> <br/> **Power BI** では、このさまざまな階層は、同じディメンションの別の階層として、フィールド リストに表示されます。  ただし、同じディメンションの 2 つの異なる階層のレベルを複数選択すると、SAP によって空のデータが返されます。 |
| 不規則な階層の処理方法 |![](media/desktop-directquery-sap-bw/directquery-sap-bw_01.png) |
| スケール係数/符号の反転 |SAP では、主要な指標に、書式設定オプションで定義する (1000 などの) スケール係数を持たせることができます。これは、すべての表示はその係数を使用してスケールされることを意味します。 <br/> <br/> 同様に、符号を逆にするプロパティ セットを持たせることもできます。 Power BI で (ビジュアルで、または計算の一部として) このようなキーとなる数値を使用すると、スケーリングされない数値が使用される結果となります (そして符号は反転されません)。 基になるスケール係数は使用されません。 Power BI ビジュアルでは、軸 (K、M、B) に表示されるスケール ユニットは、ビジュアルの書式設定の一部として制御することができます。 |
| レベルが動的に表示/非表示となる階層 |SAP BW に初めて接続するとき、階層のレベルの情報が取得され、その結果、フィールド リストにフィールドのセットが表示されます。 これはキャッシュされ、レベルのセットが変更された場合、フィールドのセットは更新が呼び出されるまで変更されません。 <br/> <br/> これは **Power BI Desktop** でのみで可能です。 レベルに変更を反映するこのような更新は、発行後は、Power BI サービスでは呼び出せません。 |
| 既定のフィルター |BEx クエリには、SAP BEx アナライザーによって自動的に適用される既定のフィルターを含めることができます。 これらは公開されないため、Power BI で同じように使用した場合、既定で同じフィルターは適用されません。 |
| 非表示の主要指標 |BEx クエリでは主要な指標を表示するかどうかを制御でき、非表示のものは SAP BEx アナライザーでは表示されません。 これらはパブリック API を使用した場合は反映されず、したがってこのような非表示の主要指標はフィールド リストに表示され続けます。 ただし、その後 Power BI で非表示にできます。 |
| 数値の書式設定 |Power BI には、数値のいかなる書式設定 (たとえば、小数の桁数、小数点など) も自動では反映されません。 ただし、Power BI 内でこの書式を制御することはできます。 |
| 階層のバージョン管理 |SAP BW では、たとえば、コスト センターの 2007 年と 2008 年の階層など、さまざまなバージョンの階層を維持できます。 Power BI では、パブリック API がバージョン情報を公開しないため、最新のバージョンのみ使用できます。 |
| 時間依存の階層 |Power BI を使用する場合、時間依存の階層は現在の日付で評価されます。 |
| 通貨の換算 |SAP BW では、キューブで保持されている率に基づく、通貨換算がサポートされています。 このような機能は、パブリック API では公開されず、Power BI では使用できません。 |
| 並べ替え順序 |SAP では、指標の (テキストまたはキーを使用した) 並べ替え順序を定義できます。 この並べ替え順序は Power BI では反映されません。 たとえば、月は、“April”、“Aug” などと表示されます。 <br/> <br/> Power BI では、この並べ替え順序は変更できません。 |
| 技術名 |**[データの取得]** には、指標/メジャー名 (説明)、および技術名の両方があります。 フィールド リストには、指標/メジャー名 (説明) のみが含まれます。 |
| 属性 |Power BI 内で指標の属性にアクセスすることはできません。 |
| エンドユーザーの言語設定 |SAP BW への接続に使用されるロケールは、接続の詳細の一部として設定されるもので、レポートの最終コンシューマーのロケールとは一致しません。 |
| テキストの変数 |SAP BW では、("$YEAR$ Actuals" など) 変数のプレースホルダーをフィールド名に含めることができます。これは、その後、選択した値で置き換えられます。 たとえば、変数に 2016 年を選択した場合、BEx ツールでは、フィールドに "2016 Actuals" と表示されます。 <br/> <br/> Power BI の列名は、変数の値によっては変わらず、したがって "$YEAR$ Actuals" と表示されます。  ただし、Power BI で列名を変更することはできます。 |
| Customer Exit 変数 | Customer Exit 変数はパブリック API では公開されず、Power BI では使用できません。 |
| 特性構造 | 基礎となる SAP BW ソースの特性構造の結果として、Power BI にはメジャーの ‘エクスプロージョン’ が公開されます。 たとえば、Sales と Costs という 2 つのメジャーと、Budget と Actual を含む 1 つの特性構造がある場合、Sales.Budget、Sales.Actual、Costs.Budget、Costs.Actual という 4 つのメジャーが公開されます。 |


## <a name="next-steps"></a>次のステップ
DirectQuery の詳細については、次のリソースを参照してください。

* [Power BI の DirectQuery](desktop-directquery-about.md)
* [DirectQuery でサポートされるデータ ソース](power-bi-data-sources.md)
* [DirectQuery と SAP HANA](desktop-directquery-sap-hana.md)
